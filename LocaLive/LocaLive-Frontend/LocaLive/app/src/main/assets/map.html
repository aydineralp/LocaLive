<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>OpenLayers Map</title>
    <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.css"
            type="text/css"
    />
    <script src="https://cdn.jsdelivr.net/npm/ol@latest/dist/ol.js"></script>
</head>
<body>
<div id="map" style="width: 100vw; height: 100vh;"></div>

<script>
    var map = new ol.Map({
        target: 'map',
        layers: [
            new ol.layer.Tile({
                source: new ol.source.OSM({
                    attributions: '' // OpenStreetMap yazÄ±sÄ±nÄ± kaldÄ±rÄ±r
                })
            })
        ],
        view: new ol.View({
            center: ol.proj.fromLonLat([29.0, 41.0]),
            zoom: 9
        })
    });

    var markerLayer = new ol.layer.Vector({
        source: new ol.source.Vector(),
    });
    map.addLayer(markerLayer);

    var routeLayer = new ol.layer.Vector({
        source: new ol.source.Vector(),
        style: new ol.style.Style({
            stroke: new ol.style.Stroke({
                color: 'blue', // Ã‡izgi rengi (Buradan deÄŸiÅŸtirebilirsin)
                width: 3
            })
        })
    });
    map.addLayer(routeLayer);

    var coordinates = [];

    function getIconByRequestGroupId(requestGroupId) {
        var iconMap = {
            1: 'file:///android_asset/musical-note.png',   // MÃ¼zik ðŸŽµ
            2: 'file:///android_asset/theatre.png', // Tiyatro ðŸŽ­
            3: 'file:///android_asset/microphone.png' // Mikrofon ðŸŽ¤ (Stand-Up, Komedi)
        };

        return iconMap[requestGroupId] || 'https://cdn-icons-png.flaticon.com/512/1673/1673221.png'; // VarsayÄ±lan ikon
    }

    function addMarker(lat, lon, eventName, requestGroupId) {
        var latitude = parseFloat(lat);
        var longitude = parseFloat(lon);
        var coord = ol.proj.fromLonLat([longitude, latitude]);
        coordinates.push(coord); // Yeni noktayÄ± kaydet

        var iconFeature = new ol.Feature({
            geometry: new ol.geom.Point(coord),
            eventName: eventName
        });

        var iconStyle = new ol.style.Style({
            image: new ol.style.Icon({
                anchor: [0.5, 1],
                src: getIconByRequestGroupId(requestGroupId),
                scale: 0.07
            })
        });

        iconFeature.setStyle(iconStyle);
        markerLayer.getSource().addFeature(iconFeature);

        // Yeni noktalar eklendikÃ§e Ã§izgiyi oluÅŸtur
        drawRoute();
    }

    function drawRoute() {
        if (coordinates.length < 2) return; // En az iki nokta varsa Ã§izgi oluÅŸtur

        var routeFeature = new ol.Feature({
            geometry: new ol.geom.LineString(coordinates)
        });

        routeLayer.getSource().clear(); // Ã–nceki Ã§izgiyi temizle
        routeLayer.getSource().addFeature(routeFeature);
    }

    function fitMarkers() {
        var extent = markerLayer.getSource().getExtent();
        if (!ol.extent.isEmpty(extent)) {
            map.getView().fit(extent, {
                padding: [50, 50, 50, 50],
                maxZoom: 16
            });
        }
    }

    map.on('singleclick', function (evt) {
        map.forEachFeatureAtPixel(evt.pixel, function (feature) {
            var name = feature.get('eventName');
            if (name) {
                alert("Etkinlik AdÄ±: " + name);
            }
        });
    });
</script>




</body>
</html>
